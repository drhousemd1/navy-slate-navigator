
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://ronqvzihpffgowyscgfm.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJvbnF2emlocGZmZ293eXNjZ2ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4NzM0NzIsImV4cCI6MjA1ODQ0OTQ3Mn0.28ftEjZYpnYOywnRdRbRRg5UKD31VPpuZ00mJH8IQtM";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

// Create a properly configured client with explicit session handling
export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    storage: typeof window !== 'undefined' ? localStorage : undefined,
    detectSessionInUrl: true,
    flowType: 'implicit'
  }
});

// Create a sample test user account for development purposes
const createTestUser = async () => {
  if (process.env.NODE_ENV === 'development') {
    try {
      const { data: existingUser, error: checkError } = await supabase
        .from('user_roles')
        .select('user_id')
        .limit(1);
        
      // If we already have users, don't create another test user
      if (!checkError && existingUser && existingUser.length > 0) {
        return;
      }
        
      // Sign out any existing session
      await supabase.auth.signOut();
      
      // Create test user
      const testEmail = 'test@example.com';
      const testPassword = 'password123';
      
      const { error: signUpError } = await supabase.auth.signUp({
        email: testEmail,
        password: testPassword
      });
      
      if (signUpError) {
        console.error('Error creating test user:', signUpError);
      } else {
        console.log('Test user created for development. Email: test@example.com, Password: password123');
      }
    } catch (err) {
      console.error('Error in createTestUser:', err);
    } finally {
      // Make sure we're signed out
      await supabase.auth.signOut();
    }
  }
};

// Only run in development mode after a short delay
if (typeof window !== 'undefined' && process.env.NODE_ENV === 'development') {
  setTimeout(createTestUser, 2000);
}
